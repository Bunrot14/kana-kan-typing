<!DOCTYPE html>
<html lang="ja">
<head>
  <link rel="canonical" href="https://typingwithclavier.com/clavier_collection.html">

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>クラヴィエの寓話集 – 指先から静けさを打つ – | かな漢タイピング</title>
    <meta name="description" content="「かな漢タイピング」に登場するキャラクター「クラヴィエ」の物語を集めたページです。鍵を持つ風が紡ぐ、哲学的で詩的なタイピング練習文をお楽しみください。">
    <meta name="keywords" content="クラヴィエ, タイピング, 物語, 詩, 哲学, バックナンバー, かな漢タイピング">

    <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
    <link rel="manifest" href="site.webmanifest" />

    <style>
       body {
    font-family: "Yu Gothic", "Hiragino Sans", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
    background-color: #f5f5f5; 
    color: #333;
    margin: 0;
    /* padding: 20px; を削除または調整 */
    line-height: 1.8;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}
.page-layout { /* ★新しいラッパー用のスタイル */
    display: flex;
    align-items: flex-start; /* 目次とコンテンツを上端揃え */
    max-width: 1050px;  /* 目次幅(220px) + 隙間(25px) + コンテナ幅(720px) + α の合計幅 */
    margin: 20px auto;  /* ページ全体を中央寄せ */
    padding: 0 20px;    /* 画面端の余白 */
    box-sizing: border-box;
}

.table-of-contents { /* 目次エリアのスタイル */
    width: 220px; 
    flex-shrink: 0; 
    position: sticky; 
    top: 20px;      /* 画面上部からの固定位置 (ヘッダーがないページなので小さめでもOK) */
    max-height: calc(100vh - 40px); /* 上下のマージンを考慮した高さ */
    overflow-y: auto; 
    padding: 15px;
    background-color: #f9f9f9; /* 目次の背景色 */
    border-radius: 6px;
    font-size: 0.9em;
    margin-right: 25px; /* ★メインコンテンツとの間の隙間 (gapの代わり) */
}

.container.page-with-toc { /* メインコンテンツの白いブロック */
    flex-grow: 1; /* 残りのスペースを全て使う */
    /* max-width: 720px; は維持 */
    margin: 0; /* page-layout が中央寄せするので、ここは0に */
    /* padding: 2rem; は維持 */
    /* background-color: #fff; などは維持 */
}

        .container { /* 利用規約ページの .container スタイルをベースに調整 */
            max-width: 720px;
            margin: 20px auto; /* 上下のマージンも追加 */
            padding: 2rem;     /* 利用規約ページと同様のパディング */
            background-color: #fff; /* コンテナの背景は白 */
            border-radius: 8px;     /* 少し角を丸める */
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); /* 控えめな影 */
        }

        header { /* ページタイトル部分のスタイル */
            text-align: center;
            margin-bottom: 2.5rem; /* 副題との間を少し空ける */
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee; /* 利用規約ページのh1の下線より控えめに */
        }

        h1 { /* メインタイトル */
            font-size: 2rem; /* 利用規約ページの1.8remより少し大きく、特集感を出す */
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .subtitle { /* 副題 */
            font-size: 1.1rem;
            color: #7f8c8d;
            margin-top: 0;
            font-weight: 300;
        }

        /* JavaScriptで挿入される各物語のエントリのスタイル */
        .story-entry {
            margin-bottom: 2.5rem; /* 各物語の間隔 */
            padding-bottom: 1.5rem;
        }
        .story-entry:not(:last-child) { /* 最後の要素以外の下に区切り線 */
             border-bottom: 1px dotted #ddd;
        }


        .story-title { /* 各物語のタイトル (h3タグで生成される想定) */
            font-size: 1.5rem; /* 利用規約ページのh2に近いサイズ感 */
            color: #34495e;
            margin-top: 0;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .story-date { /* 初出日 */
            font-size: 0.85rem;
            color: #777;
            margin-bottom: 0.8rem;
        }

        .story-excerpt { /* 本文抜粋 */
            font-size: 1em;
            color: #555;
            margin-top: 0;
            margin-bottom: 1rem;
        }

       .practice-link {
  display: inline-block;
  margin-top: 0.5rem;
  padding: 0.5rem 1rem; /* .problem-buttons と同じパディング */
  background: #ccc;      /* 初期の背景色を統一 */
  color: black;          /* デフォルト文字色（必要に応じて調整） */
  text-decoration: none;
  border: none;
  border-radius: 5px;     /* .problem-buttons と統一 */
  font-size: 0.9rem;
  cursor: pointer;
  transition: background-color 0.2s;
}

.practice-link:hover {
  background: #aaa;       /* .problem-buttons:hover と一致 */
}

.practice-link.active {
  background: #888;       /* .problem-buttons .active と一致 */
  color: white;
}


        /* ページ下部のナビゲーションリンク */
        .nav-links {
            text-align: center;
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid #eee;
        }
        .nav-links a {
            color: #007acc;
            text-decoration: none;
            margin: 0 10px;
            font-weight: bold;
            padding: 8px 12px;
            border-radius: 5px;
            transition: background-color 0.2s, color 0.2s;
        }
        .nav-links a:hover {
            background-color: #007acc;
            color: #fff;
            text-decoration: none;
        }

        /* smallタグは利用規約ページから拝借 */
        small {
             display: block;
             font-size: 0.8rem;
             color: #666;
             margin-top: 3rem;
             text-align: center;
        }

/* clavier_collection.html の <style> タグ内に追加 */

        .featured-stories-container {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
        }
        .featured-story { /* 特集する各物語のコンテナ */
            background-color: #f9f9f9; /* 少し背景色を変えて目立たせる（任意）*/
            border-left: 5px solid #007acc; /* 左側にアクセントボーダー（任意）*/
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 6px;
        }
        .featured-story .story-title { /* 特集内のタイトルは少し小さめにしても良いかも */
            font-size: 1.3em; 
        }
        .featured-story .story-excerpt {
            font-size: 0.95em;
        }
        .section-divider {
            border: 0;
            border-top: 1px solid #eee;
            margin: 2rem 0;
        }

        /* clavier_collection.html の <style> タグ内に追加・修正 */

/* ... 既存の body, .container, header.page-header などのスタイルはそのまま ... */

/*.page-with-toc .container { /* 必要であればコンテナのpaddingなどを調整 */
    /* max-width はそのままで良いか、少し広げるか検討 */*/

.table-of-contents { /* 目次エリアのスタイル */
    width: 220px; /* 目次の幅（お好みで調整） */
    flex-shrink: 0; /* 目次の幅が縮まないようにする */
    position: sticky; /* スクロールに追従（ある位置で固定） */
    top: 80px;      /* 画面の上からどの位置で固定し始めるか (ヘッダーの高さなどを考慮) */
    max-height: calc(100vh - 100px); /* 目次の最大高さを画面の高さから少し引いた値に */
    overflow-y: auto; /* 目次が長くなった場合にスクロールできるように */
    padding: 15px;
    background-color: #f9f9f9; /* 目次の背景色（任意） */
    border-radius: 6px;
    font-size: 0.9em;
}

.table-of-contents h2 { /* 目次の「目次」という見出し */
    font-size: 1.2em;
    margin-top: 0;
    margin-bottom: 15px;
    color: #333;
    border-bottom: 1px solid #ddd;
    padding-bottom: 8px;
}

.table-of-contents ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.table-of-contents li a {
    display: block;
    padding: 6px 0;
    color: #007acc;
    text-decoration: none;
    border-bottom: 1px dotted #eee;
    transition: background-color 0.2s;
}
.table-of-contents li:last-child a {
    border-bottom: none;
}

.table-of-contents li a:hover {
    background-color: #e9ecef;
    color: #005fa3;
}
.table-of-contents li a.active { /* 現在地を示すスタイル (任意) */
    font-weight: bold;
    color: #005fa3;
}


.main-content-for-toc { /* メインコンテンツエリアのスタイル */
    flex-grow: 1; /* 残りの幅を全て使う */
    min-width: 0; /* flexアイテムが正しく縮小できるように */
}

/* .story-entry, .story-title などのスタイルは既存のものを活用 */
/* 必要であれば、目次と連動させるために .story-entry に scroll-margin-top を設定 */
.story-entry {
    scroll-margin-top: 40px; /* top: 20px + α のマージンを考慮 */
}

/* ======== レスポンシブ対応CSS ======== */
@media (max-width: 900px) {
  body {
    padding: 1rem !important;
  }

  #display, #typingArea {
    width: 98vw !important;
    min-width: 0 !important;
    max-width: 100vw !important;
    font-size: 1em !important;
  }

  .problem-container {
    flex-direction: column !important;
    align-items: stretch !important;
  }

  .title-and-usage-container {
    left: 0 !important;
    justify-content: flex-start !important;
    margin-top: 1rem;
    flex-direction: column !important;
    align-items: flex-start !important;
  }

  .title-and-usage-container h1 {
    font-size: 1.3em !important;
    margin-bottom: 0.6em;
  }
  .header-left-controls, .header-right-controls {
    margin: 0 !important;
    align-items: flex-start !important;
  }
}

@media (max-width: 600px) {
  html, body {
    font-size: 15px !important;
    padding: 0.5rem !important;
  }

  #display, #typingArea {
    width: 99vw !important;
    min-width: 0 !important;
    max-width: 100vw !important;
    padding: 0.7rem !important;
    font-size: 1em !important;
  }

  .donation-container {
    flex-direction: column !important;
    gap: 16px !important;
  }
  .donation-box {
    max-width: 100vw !important;
    min-width: 0 !important;
  }

  .problem-buttons,
  .archive-titles {
    flex-wrap: wrap !important;
    gap: 7px !important;
    justify-content: flex-start !important;
  }

  .archive-titles button,
  .problem-buttons button {
    font-size: 1em !important;
    padding: 6px 12px !important;
    min-width: 88px;
  }
}

/* モーダルやポップアップの最大幅を調整 */
@media (max-width: 600px) {
  .usage-guide-content,
  #popup {
    max-width: 95vw !important;
    min-width: 0 !important;
    padding: 0.8em !important;
    font-size: 1em !important;
  }
}

/* アーカイブなどの余白も調整 */
@media (max-width: 600px) {
  #archive {
    margin-top: 1.2rem !important;
    padding: 0 !important;
  }
  #archive-list {
    margin-top: 0.8rem !important;
  }
}

/* サイトイントロやフッターも余白調整 */
@media (max-width: 600px) {
  .site-intro {
    font-size: 0.95em !important;
    padding: 0.4em !important;
    line-break: strict;
  }
  footer {
    font-size: 0.95em !important;
    padding: 0.2em !important;
  }
}
/* --- スマホ目次ハンバーガーUI --- */
#toc-toggle-btn {
  display: none;
  position: fixed;
  top: 14px;
  left: 16px;
  z-index: 2001;
  background: #007acc;
  color: #fff;
  font-size: 1.12em;
  border: none;
  border-radius: 7px;
  padding: 9px 17px 9px 15px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  cursor: pointer;
  letter-spacing: 0.1em;
}
@media (max-width: 900px) {
  .page-layout {
    flex-direction: column;
    padding: 0 !important;
  }
  .table-of-contents {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    z-index: 2000;
    width: 92vw !important;
    max-width: 350px;
    height: 100vh !important;
    max-height: 100vh !important;
    overflow-y: auto !important;
    box-shadow: 2px 0 10px rgba(0,0,0,0.10);
    transform: translateX(-120%);
    transition: transform 0.24s cubic-bezier(.42,.7,.3,1.02);
    background: #f9f9f9;
    border-radius: 0 13px 13px 0;
  }
  .table-of-contents.open {
    transform: translateX(0);
  }
  #toc-toggle-btn {
    display: block;
  }
}
/* 開いている間は本体をスクロール禁止に */
body.toc-open {
  overflow: hidden !important;
}
@media (max-width: 900px) {
  .container.page-with-toc {
    margin-left: 0 !important;
    padding-top: 48px !important;
    padding-left: 0 !important;
    max-width: 100vw !important;
    width: 100vw !important;
    box-sizing: border-box;
  }
}

    </style>
</head>
<body>

  <button id="toc-toggle-btn" aria-label="目次を開く">☰ 目次</button>

   <div class="page-layout"> <nav id="toc-nav" class="table-of-contents">
            <h2>目次</h2>
            <ul id="toc-list">
                </ul>
        </nav>

        <div class="container page-with-toc"> <header class="page-header">
                <h1>クラヴィエの寓話集</h1>
                <p class="subtitle">── 鍵を持つ風が紡ぐ、ささやかな奇跡 ──</p>
            </header>

            <div id="featured-clavier-stories" class="featured-stories-container">
                </div>
            <hr class="section-divider"> 
            <main id="clavier-stories-list" class="main-content-for-toc">
                </main>

            <nav class="nav-links">
                <a href="index.html">タイピング練習に戻る</a>
                <a href="archive.html">すべてのバックナンバー</a>
                <a href="Criticism_index.html">問題文の裏庭</a>
            </nav>
</div> </div>


<footer style="position: static; bottom: 0; width: 100%; text-align: center; font-size: 12px; padding: 1px; background: #f5f5f5; margin-top: 2rem;">
    <p style="margin: 0;">
       <a href="meditation_typing.html">瞑想的タイピングのすすめ</a> |
            <a href="philosophy.html">問題文に込めた想い</a> |
            <a href="Misconversion.html">誤変換のポエジー</a> <br>
      練習用テキストはすべてフィクションであり、特定の思想、団体、個人を揶揄・批判する意図はありません。
      <br>
      <a href="terms.html" style="color: #007acc; text-decoration: none;">利用規約</a> |
      <a href="privacy.html" style="color: #007acc; text-decoration: none;">プライバシーポリシー</a> |
      <a href="contact.html" style="color: #0f8de1; text-decoration: none;">お問い合わせ</a>
    </p>
    <p style="margin: 0;">&copy; 2025 Bunrot's Typing Site. All Rights Reserved.</p>
    <p style="margin: 0;">運営者：Bunrot</p>
  </footer>

  <script>
 // clavier_collection.html の <script> タグ内に記述する内容

document.addEventListener('DOMContentLoaded', function() {
    // HTML要素を取得
    const featuredStoriesContainer = document.getElementById('featured-clavier-stories');
    const clavierStoriesListContainer = document.getElementById('clavier-stories-list');
    const tocListContainer = document.getElementById('toc-list');

    // typing_data.json から読み込んだ全データを保持するための配列
    let allSiteData = []; 

    /**
     * typing_data.jsonを読み込み、特集ストーリー、クラヴィエ関連ストーリー、目次を表示するメイン関数
     */
    async function loadAndProcessStories() {
      // 主要なコンテナ要素のいずれかが存在するか確認
      if (!clavierStoriesListContainer && !featuredStoriesContainer && !tocListContainer) {
        console.error('表示に必要なHTML要素(コンテンツリスト、特集、または目次)が見つかりません。処理を中断します。');
        return;
      }

      try {
        // JSONデータをフェッチ
        const response = await fetch('typing_data.json');
        if (!response.ok) {
          throw new Error(`JSONファイルの読み込みに失敗しました。ステータス: ${response.status}`);
        }
        allSiteData = await response.json(); // JSONをパースして変数に格納

        // JSONデータが期待する形式（配列）であるか確認
        if (!Array.isArray(allSiteData)) {
          throw new Error("読み込まれたJSONデータの形式が正しくありません。ルートは配列であるべきです。");
        }

        // 特集ストーリーを描画 (対応するHTML要素があれば)
        if (featuredStoriesContainer) {
            renderFeaturedStories();
        }
        // クラヴィエ関連の通常ストーリーリストと目次を描画 (対応するHTML要素があれば)
        if (clavierStoriesListContainer && tocListContainer) {
            renderClavierStoriesAndToc();
        }

      } catch (error) {
        console.error("データ処理中にエラーが発生しました:", error);
        // エラーメッセージを適切な場所に表示
        const errorMessage = `<p style="color: red; text-align:center;">データの読み込み中にエラーが発生しました。<br>お手数ですが、時間をおいて再度お試しください。<br><small>エラー詳細: ${error.message}</small></p>`;
        if (clavierStoriesListContainer) clavierStoriesListContainer.innerHTML = errorMessage;
        if (featuredStoriesContainer) featuredStoriesContainer.innerHTML = ""; // 特集エリアもクリア
        if (tocListContainer) tocListContainer.innerHTML = '<li>目次を生成できませんでした</li>';
      }
    }

    /**
     * 指定されたタイトル「鍵を持つ風」と「Clavier」を特集表示する関数
     */
    function renderFeaturedStories() {
      const featuredTitles = ["鍵を持つ風", "Clavier"]; // 特集したい物語の正確なタイトル
      let featuredHtmlContent = '';
      let foundStoriesCount = 0;

      allSiteData.forEach((dailyEntry, setIndex) => {
        if (dailyEntry.essays && Array.isArray(dailyEntry.essays)) {
          dailyEntry.essays.forEach((essay, indexInSet) => {
            if (featuredTitles.includes(essay.title)) {
              foundStoriesCount++;
              const story = { 
                title: essay.title || "タイトルなし",
                text: essay.text || "",
                date: dailyEntry.date,
                sessionName: dailyEntry.sessionName || "",
                setIndex: setIndex,
                indexInSet: indexInSet
              };

              const dateObj = new Date(story.date);
              const year = dateObj.getFullYear();
              const month = (dateObj.getMonth() + 1).toString().padStart(2, '0');
              const day = dateObj.getDate().toString().padStart(2, '0');
              const displayDate = `${year}年${month}月${day}日 ${story.sessionName}`.trim();
              
              const excerptLength = 120; 
              const excerpt = story.text.substring(0, excerptLength).replace(/\n/g, ' ') + (story.text.length > excerptLength ? '...' : '');

              featuredHtmlContent += `
                <div class="featured-story"> 
                  <h3 class="story-title">${story.title}</h3>
                  <p class="story-date">初出: ${displayDate}</p>
                  <p class="story-excerpt">${excerpt}</p>
                  <a href="index.html" class="practice-link" 
                     data-set-index="${story.setIndex}" 
                     data-essay-index-in-set="${story.indexInSet}">「${story.title}」でタイピング練習</a>
                </div>
              `;
            }
          });
        }
      });
      
      if (foundStoriesCount > 0) {
          featuredStoriesContainer.innerHTML = `<h2>クラヴィエとは？ - 代表的な物語</h2>` + featuredHtmlContent;
      } else {
          featuredStoriesContainer.innerHTML = ''; // 見つからなければ何も表示しないか、代替メッセージ
      }
      addLinkListenersToContainer(featuredStoriesContainer); // 特集表示内のリンクにもイベントリスナーを設定
    }

    /**
     * 抽出されたクラヴィエ関連のストーリーをメインコンテンツと目次に描画する関数
     */
    function renderClavierStoriesAndToc() {
      const clavierEssays = []; 

      allSiteData.forEach((dailyEntry, setIndex) => {
        if (dailyEntry.essays && Array.isArray(dailyEntry.essays)) {
          dailyEntry.essays.forEach((essay, indexInSet) => {
            if (essay.tags && Array.isArray(essay.tags) && essay.tags.includes("クラヴィエ")) {
              clavierEssays.push({
                title: essay.title || "タイトルなし",
                text: essay.text || "",
                date: dailyEntry.date, 
                sessionName: dailyEntry.sessionName || "", 
                setIndex: setIndex, 
                indexInSet: indexInSet,
                uniqueId: `story-${setIndex}-${indexInSet}` // 各物語にユニークなIDを生成
              });
            }
          });
        }
      });

      if (clavierEssays.length === 0) {
        clavierStoriesListContainer.innerHTML = '<p style="text-align:center;">現在、クラヴィエが登場する物語は見つかりませんでした。</p>';
        tocListContainer.innerHTML = '<li>該当する物語はありません</li>';
        return;
      }

      let mainHtmlContent = '';
      let tocHtmlContent = '';

      // 通常リストの見出し (特集表示がない、または特集表示に見出しがない場合に追加)
      let mainListTitle = '<h2>すべてのクラヴィエの物語</h2>';
      if (featuredStoriesContainer && featuredStoriesContainer.querySelector('h2')) {
          mainListTitle = ''; // 特集セクションが既に見出しを持っていれば、通常リストの見出しは不要にするか調整
      }
      mainHtmlContent += mainListTitle;


      clavierEssays.forEach(story => {
        const dateObj = new Date(story.date);
        const year = dateObj.getFullYear();
        const month = (dateObj.getMonth() + 1).toString().padStart(2, '0');
        const day = dateObj.getDate().toString().padStart(2, '0');
        const displayDate = `${year}年${month}月${day}日 ${story.sessionName}`.trim();
        
        const excerptLength = 80; 
        const excerpt = story.text.substring(0, excerptLength).replace(/\n/g, ' ') + (story.text.length > excerptLength ? '...' : '');

        // メインコンテンツのHTML
        mainHtmlContent += `
          <div class="story-entry" id="${story.uniqueId}">
            <h3 class="story-title">${story.title}</h3>
            <p class="story-date">初出: ${displayDate}</p>
            <p class="story-excerpt">${excerpt}</p>
            <a href="index.html" class="practice-link" 
               data-set-index="${story.setIndex}" 
               data-essay-index-in-set="${story.indexInSet}">この物語でタイピング練習</a>
          </div>
        `;
        
        // 目次のHTML (タイトルのみ)
        tocHtmlContent += `<li><a href="#${story.uniqueId}">${story.title}</a></li>`;
      });

      clavierStoriesListContainer.innerHTML = mainHtmlContent;
      tocListContainer.innerHTML = tocHtmlContent;

      addLinkListenersToContainer(clavierStoriesListContainer); // メインコンテンツの練習リンク
      addTocLinkSmoothScroll(); // 目次リンクにスムーズスクロールを追加
    }

    /**
     * 指定されたコンテナ内の練習リンクにイベントリスナーを設定する汎用関数
     */
    function addLinkListenersToContainer(containerElement) {
      if (!containerElement) return;
      const links = containerElement.querySelectorAll('.practice-link');
      links.forEach(link => {
        if (link.dataset.listenerAttached) return; // 二重登録防止

        link.addEventListener('click', function(event) {
          event.preventDefault(); 
          const setIndex = parseInt(this.dataset.setIndex, 10);
          const essayIndexInSet = parseInt(this.dataset.essayIndexInSet, 10);
          const problemInfo = {
            setIndex: setIndex,
            essayIndexInSet: essayIndexInSet
          };
          localStorage.setItem('selectedTypingProblem', JSON.stringify(problemInfo));
          window.location.href = this.href; 
        });
        link.dataset.listenerAttached = 'true';
      });
    }

    /**
     * 目次の各リンクにスムーズスクロール機能を追加する関数
     */
    function addTocLinkSmoothScroll() {
      if (!tocListContainer) return;
      const tocLinks = tocListContainer.querySelectorAll('a');
      tocLinks.forEach(link => {
        if (link.dataset.scrollListenerAttached) return; // 二重登録防止

        link.addEventListener('click', function(event) {
          event.preventDefault();
          const targetId = this.getAttribute('href').substring(1);
          const targetElement = document.getElementById(targetId);
          if (targetElement) {
            targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // (任意) クリックされた目次リンクをアクティブにする
            tocLinks.forEach(tl => tl.classList.remove('active'));
            this.classList.add('active');
          }
        });
        link.dataset.scrollListenerAttached = 'true';
      });
    }

    // ページの読み込みが完了したら、メインの処理を開始
    loadAndProcessStories();
});
// スマホ用目次ハンバーガー
(function() {
  const tocBtn = document.getElementById('toc-toggle-btn');
  const tocNav = document.getElementById('toc-nav');
  const body = document.body;

  function isMobileView() {
    return window.matchMedia('(max-width: 900px)').matches;
  }
  function openToc() {
    tocNav.classList.add('open');
    body.classList.add('toc-open');
  }
  function closeToc() {
    tocNav.classList.remove('open');
    body.classList.remove('toc-open');
  }
  if (tocBtn && tocNav) {
    tocBtn.addEventListener('click', function() {
      if (tocNav.classList.contains('open')) {
        closeToc();
      } else {
        openToc();
      }
    });
  }
  // 目次のリンクや余白タップで自動閉じ
  if (tocNav) {
    tocNav.addEventListener('click', function(e) {
      if (
        isMobileView() &&
        (e.target.tagName === 'A' || e.target === tocNav)
      ) {
        setTimeout(closeToc, 200); // スクロール後に閉じる
      }
    });
  }
  // リサイズでPC幅になったら強制close
  window.addEventListener('resize', function() {
    if (!isMobileView()) closeToc();
  });
  // escキーで閉じる
  window.addEventListener('keydown', function(e) {
    if (isMobileView() && tocNav.classList.contains('open') && e.key === 'Escape') {
      closeToc();
    }
  });
})();

  </script>




</body>
</html>